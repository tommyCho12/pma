<html lang="en"
        xmlns:th="http://www.thymeleaf.org"
        xmlns:sec="https://www.thymeleaf.org/thymeleaf-extras-springsecurity5">

<head th:fragment="header">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
          integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="an onymous">

    <link rel="stylesheet" th:href="@{/css/formatting.css}">

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.8.0"></script>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

</head>

<nav th:fragment="navbar" class="navbar navbar-expand-lg navbar-dark bg-primary">
    <a class="navbar-brand" href="#">Project IO</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav mr-auto">
            <li class="nav-item active">
                <a class="nav-link" th:href="@{/}">Home</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/employees}">Employees</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/projects}">Projects</a>
            </li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/projects/timelines}">Timelines</a>
            </li>
        </ul>
        <ul sec:authorize="isAuthenticated()" class="navbar-nav px-3">
            <li class="nav-item" sec:authentication="name"></li>
            <li class="nav-item">
                <a class="nav-link" th:href="@{/logout}">Logout</a>
            </li>
        </ul>
        <ul sec:authorize="!isAuthenticated()" class="navbar-nav px-3">
            <li class="nav-item">
                <a class="nav-link" th:href="@{/login}">Log In</a>
            </li>
        </ul>
    </div>
</nav>

<th:block th:fragment="footer">
    <footer class="bg-dark text-light d-flex justify-content-between align-items-center px-4"
            style="height: 60px; position: fixed; bottom: 0; left: 0; width: 100%; z-index: 1050;">

        <!-- âœ… Version aligned to the left -->
        <div>
            <small>Version: <span th:text="${version}"></span></small>
        </div>

        <button id="chat-toggle" class="btn btn-outline-light">
            ðŸ’¬ Chat
        </button>

        <!-- Hidden Chat Window -->
        <div id="chatbot-window" class="position-fixed border rounded shadow bg-white"
             style="width: 320px; height: 420px; bottom: 70px; right: 20px; display: none; flex-direction: column; z-index: 1100;">

            <!-- Chat header -->
            <div class="bg-primary text-white p-2 d-flex justify-content-between align-items-center">
                <span>Chatbot</span>
                <button id="chat-close" class="btn btn-sm btn-light">Ã—</button>
            </div>

            <!-- Chat content -->
            <div id="chat-messages" class="p-2 flex-grow-1 overflow-auto" style="font-size: 0.9rem;"></div>

            <!-- Chat input -->
            <div class="d-flex p-2 border-top">
                <input type="text" id="chat-input" class="form-control form-control-sm me-2" placeholder="Type message...">
                <button id="send-btn" class="btn btn-sm btn-primary">Send</button>
            </div>
        </div>

        <script>
            const toggleBtn = document.getElementById('chat-toggle');
            const chatWindow = document.getElementById('chatbot-window');
            const closeBtn = document.getElementById('chat-close');
            const sendBtn = document.getElementById('send-btn');
            const input = document.getElementById('chat-input');
            const messages = document.getElementById('chat-messages');

            toggleBtn.addEventListener('click', () => {
                chatWindow.style.display = 'flex';
                toggleBtn.style.display = 'none';
            });

            closeBtn.addEventListener('click', () => {
                chatWindow.style.display = 'none';
                toggleBtn.style.display = 'block';
            });

            function addMessage(sender, text) {
                const msg = document.createElement('div');
                msg.className = sender === 'user' ? 'text-end text-primary' : 'text-start text-success';
                msg.textContent = text;
                messages.appendChild(msg);
                messages.scrollTop = messages.scrollHeight;
            }

            function sendMessage() {
                const text = input.value.trim();
                if (!text) return;
                addMessage('user', text);
                input.value = '';
                setTimeout(() => addMessage('bot', 'This is a demo reply.'), 800);
            }

            sendBtn.addEventListener('click', () => {
                const text = input.value.trim();
                if (!text) return;
                addMessage('user', text);
                input.value = '';
                setTimeout(() => addMessage('bot', 'This is a demo reply.'), 800);
            });

            // âœ… Send on Enter key
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {  // allows shift+enter for new line if needed
                    e.preventDefault();
                    sendMessage();
                }
            });

        </script>
    </footer>
</th:block>